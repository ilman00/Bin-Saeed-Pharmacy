<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div class="container my-4">
    <h2>Sale Page</h2>

    <!-- Type Selection -->
    <div class="mb-3">
      <label for="productType" class="form-label fw-bold">Select Product Type</label>
      <select id="productType" class="form-select">
        <option value="Medicine">Medicine</option>
        <option value="Cosmetic">Cosmetic</option>
      </select>
    </div>

    <!-- Product Search -->
    <div class="mb-3">
      <label for="productSearch" class="form-label fw-bold">Search Product</label>
      <input type="text" id="productSearch" class="form-control" placeholder="Search by Brand...">
    </div>

    <!-- Sale Table -->
    <table class="table table-bordered" id="saleTable">
      <thead class="table-secondary">
        <tr>
          <th>Brand</th>
          <th>Price (PKR)</th>
          <th>Quantity</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="saleTableBody">
        <!-- Sale items will be added here dynamically -->
      </tbody>
    </table>

  </div>
  <script>
    const productTypeSelect = document.getElementById('productType');
    const productSearchInput = document.getElementById('productSearch');
    const saleTableBody = document.getElementById('saleTableBody');

    let selectedType = 'Medicine'; // Default

    productTypeSelect.addEventListener('change', (e) => {
      selectedType = e.target.value;
      productSearchInput.value = '';
      // Clear table when type changes (optional)
      saleTableBody.innerHTML = '';
    });

    productSearchInput.addEventListener('input', async (e) => {
      const searchQuery = e.target.value.trim();

      if (searchQuery.length < 2) {
        // If search text is too short, don't search
        return;
      }

      try {
        const response = await fetch(`/api/products?type=${selectedType}&brand=${searchQuery}`);
        const products = await response.json();
        displayProducts(products);
      } catch (error) {
        console.error('Error fetching products:', error);
      }
    });

    function displayProducts(products) {
      saleTableBody.innerHTML = '';

      products.forEach(product => {
        const total = (product.price * 1).toFixed(2); // default quantity 1
        saleTableBody.innerHTML += `
      <tr>
        <td>${product.brand}</td>
        <td>₨${product.price}</td>
        <td><input type="number" value="1" min="1" class="form-control quantity-input" data-price="${product.price}"></td>
        <td class="total-cell">₨${total}</td>
      </tr>
    `;
      });

      updateTotals();
    }

    function updateTotals() {
      document.querySelectorAll('.quantity-input').forEach(input => {
        input.addEventListener('input', function () {
          const price = parseFloat(this.getAttribute('data-price'));
          const quantity = parseInt(this.value) || 1;
          const totalCell = this.closest('tr').querySelector('.total-cell');
          totalCell.textContent = `₨${(price * quantity).toFixed(2)}`;
        });
      });
    }

  </script>
</body>

</html>