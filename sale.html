<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sell Medicines</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .qty-input {
      width: 80px;
    }
  </style>
</head>
<body class="bg-light">

  <div class="container mt-5">
    <h2 class="mb-4">Sell Medicines</h2>

    <form action="/sale/confirm" method="POST">
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Name</th>
            <th>Category</th>
            <th>Available</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          <!-- <% medicines.forEach((med, index) => { %> -->
          <tr>
            <!-- <td><%= med.name %></td>
            <td><%= med.category %></td>
            <td><%= med.stock %></td>
            <td>$<%= med.price %></td> -->
            <td>medicine name</td>
            <td>Category</td>
            <td>Stock</td>
            <td>Price</td>
            <td>
              <input type="hidden" name="items[][id]" value="">
              <input type="hidden" name="items[][name]" value="">
              <input type="hidden" name="items[][price]" value="">
              <input type="number" class="form-control qty-input" name="items[<%= index %>][quantity]" min="0" max="" value="0" onchange="calculateTotal()">
            </td>
            <td class="subtotal">$0.00</td>
          </tr>
          <!-- <% }) %> -->
        </tbody>
      </table>

      <div class="d-flex justify-content-between align-items-center mt-4">
        <h4>Total: <span id="totalPrice">$0.00</span></h4>
        <button type="submit" class="btn btn-success btn-lg">Confirm Sale</button>
      </div>
    </form>
  </div>

  <script>
    function calculateTotal() {
      let total = 0;
      const rows = document.querySelectorAll('tbody tr');

      rows.forEach(row => {
        const qtyInput = row.querySelector('input[type="number"]');
        const price = parseFloat(row.querySelector('input[name$="[price]"]').value);
        const quantity = parseInt(qtyInput.value) || 0;
        const subtotal = quantity * price;
        row.querySelector('.subtotal').innerText = `$${subtotal.toFixed(2)}`;
        total += subtotal;
      });

      document.getElementById('totalPrice').innerText = `$${total.toFixed(2)}`;
    }
  </script>

</body>
</html>
